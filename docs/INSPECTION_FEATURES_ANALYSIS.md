# 外観検査機能の不足要素分析

## 現在実装されている機能

✅ **基本機能**
- カメラ映像のリアルタイム表示
- アンサンブルモデルによる欠陥予測
- 予測結果と信頼度の表示
- 検査開始/停止ボタン
- 良品/不良品の色分け表示

## 不足している要素

### 1. **検査履歴・ログ保存機能** 🔴 重要度: 高
**現状**: 検査結果が保存されない
**必要な機能**:
- 検査結果のタイムスタンプ付き記録
- 検査ログのCSV/JSON形式での保存
- 検査履歴の閲覧機能
- 日付/時間での検索・フィルタリング

**実装イメージ**:
```python
# 検査ログの保存
{
    "timestamp": "2024-01-15 14:30:25",
    "prediction": "black_spot",
    "confidence": 0.95,
    "is_ok": false,
    "image_path": "logs/20240115_143025_black_spot.jpg"
}
```

### 2. **統計情報表示** 🔴 重要度: 高
**現状**: 統計情報が表示されない
**必要な機能**:
- 検査件数のカウント（総数、OK、NG）
- 良品率の表示
- クラス別集計（良品、黒点、欠け、傷、凹み、歪み）
- 時系列グラフ（1時間あたりの検査数など）

**表示項目**:
- 総検査数: 150件
- 良品: 120件 (80%)
- 不良品: 30件 (20%)
  - 黒点: 10件
  - 欠け: 8件
  - 傷: 7件
  - 凹み: 3件
  - 歪み: 2件

### 3. **画像保存機能** 🔴 重要度: 高
**現状**: 検査画像が保存されない
**必要な機能**:
- NG検出時の自動保存（オプション）
- 手動保存ボタン（任意のタイミングで保存）
- 保存先フォルダの選択
- 画像ファイル名の規則（タイムスタンプ+クラス名）

**保存形式**:
- フォルダ構造: `inspection_results/YYYY-MM-DD/`
- ファイル名: `20240115_143025_black_spot_0.95.jpg`

### 4. **検査結果のエクスポート** 🟡 重要度: 中
**現状**: 結果を外部に出力できない
**必要な機能**:
- CSV形式でのエクスポート（Excel互換）
- JSON形式でのエクスポート
- PDF形式でのレポート生成
- 日付範囲指定でのエクスポート

**エクスポート項目**:
- タイムスタンプ
- 予測クラス
- 信頼度
- 良品/不良品判定
- 画像パス（オプション）

### 5. **カメラ選択機能** 🟡 重要度: 中
**現状**: カメラIDが固定（camera_id=0）
**必要な機能**:
- 複数カメラの検出
- カメラ選択ドロップダウン
- カメラ解像度の設定
- カメラ設定の保存

**実装イメージ**:
- 起動時に利用可能なカメラを検出
- カメラ名（例: "USB Camera", "HD Webcam"）を表示
- ユーザーが選択可能

### 6. **信頼度閾値設定** 🟡 重要度: 中
**現状**: 閾値が設定できない
**必要な機能**:
- 信頼度閾値の設定（例: 0.8以下は警告）
- 低信頼度時の警告表示
- 閾値以下での判定を"不明"として扱う
- 信頼度ヒストグラムの表示

**設定例**:
- 信頼度 < 0.7: "判定保留"（黄色表示）
- 信頼度 >= 0.7: 通常判定（緑/赤表示）

### 7. **アラート機能** 🟡 重要度: 中
**現状**: NG検出時の通知がない
**必要な機能**:
- NG検出時の音声通知（オプション）
- 視覚的アラート（画面の点滅、色変更）
- アラート音のカスタマイズ
- 通知ログの記録

**実装イメージ**:
- NG検出時に"ピー"音
- 画面の枠が赤く点滅
- ステータスバーに警告表示

### 8. **FPS表示と検査速度** 🟢 重要度: 低
**現状**: 処理速度が不明
**必要な機能**:
- FPS（フレーム/秒）の表示
- 予測処理時間の表示
- パフォーマンス統計（平均FPS、最大/最小FPS）
- システムリソース使用率の表示

**表示項目**:
- FPS: 8.5 fps
- 予測時間: 118ms
- システム負荷: CPU 45%, GPU 60%

### 9. **予測履歴表示** 🟡 重要度: 中
**現状**: 過去の予測結果が見れない
**必要な機能**:
- 直近の予測結果一覧（10件、20件など）
- 履歴のスクロール表示
- タイムスタンプ付き
- クリックで詳細表示

**表示形式**:
```
[14:30:25] 黒点 (95%) ❌
[14:30:20] 良品 (98%) ✅
[14:30:15] 傷 (87%) ❌
...
```

### 10. **フィードバック機能** 🟡 重要度: 中
**現状**: 誤判定の修正ができない
**必要な機能**:
- 予測結果の手動修正ボタン
- 修正データの保存（再学習用）
- フィードバック統計の表示
- 学習データへの自動追加（オプション）

**実装イメージ**:
- "誤判定"ボタンを追加
- 正しいクラスを選択
- 画像とメタデータを保存
- 後で再学習に使用

### 11. **バッチ検査機能** 🟢 重要度: 低
**現状**: リアルタイム検査のみ
**必要な機能**:
- 画像フォルダの一括検査
- 検査結果の一括出力
- バッチ処理の進捗表示
- エラー処理とスキップ機能

### 12. **設定保存機能** 🟢 重要度: 低
**現状**: 設定が保存されない
**必要な機能**:
- カメラ設定の保存
- 信頼度閾値の保存
- UI設定の保存（ウィンドウサイズなど）
- 設定のインポート/エクスポート

## 優先度別実装推奨順

### 🔴 高優先度（必須）
1. 検査履歴・ログ保存機能
2. 統計情報表示
3. 画像保存機能

### 🟡 中優先度（推奨）
4. 検査結果のエクスポート
5. カメラ選択機能
6. 信頼度閾値設定
7. アラート機能
8. 予測履歴表示
9. フィードバック機能

### 🟢 低優先度（あると便利）
10. FPS表示と検査速度
11. バッチ検査機能
12. 設定保存機能

## 実装時の注意点

1. **パフォーマンス**: 画像保存やログ記録は非同期処理に
2. **ストレージ**: 画像保存によるディスク容量の管理
3. **UI/UX**: 統計情報は見やすく、操作しやすい形式で
4. **エラーハンドリング**: カメラエラー、保存エラーへの対応
5. **マルチスレッド**: UIブロックを避けるための適切なスレッド管理



















