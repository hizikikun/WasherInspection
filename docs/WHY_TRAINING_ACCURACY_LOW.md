# なぜ訓練精度が高くならないのか？

## 🔍 問題の原因

現在の結果は**非常に異常**です。通常、訓練精度はバリデーション精度より高くなるはずです。

```
EfficientNetB2:
  訓練精度: 31.97%  ← 低い
  バリデーション精度: 80.54%  ← 高い（異常！）
```

## 📊 根本原因：データ拡張が強すぎる

### 現在の設定

**訓練データ**には**非常に強いデータ拡張**が適用されています：

```python
# 訓練データ（拡張あり）
train_datagen = ImageDataGenerator(
    rotation_range=30-45度,        # 強い回転
    width_shift_range=0.2-0.3,     # 強い平行移動
    height_shift_range=0.2-0.3,
    shear_range=0.2-0.3,           # 強いせん断
    zoom_range=0.2-0.3,            # 強い拡大縮小
    brightness_range=[0.8, 1.2],   # 明るさ変化
    horizontal_flip=True,
    vertical_flip=False/True,
    ...
)

# バリデーションデータ（拡張なし）
val_datagen = ImageDataGenerator(
    rescale=1./255,  # 正規化だけ
)
```

### 何が起きているか

1. **訓練時**:
   - 元の画像 → **強い拡張が適用** → モデルが学習
   - 例：元画像を45度回転、明るさを70%に変更、20%拡大など
   - **拡張されたデータは「難しく」なる**

2. **訓練精度の計算**:
   - 拡張された（難しい）データでの精度を計算
   - → **低い精度になる**

3. **バリデーション精度の計算**:
   - 拡張されていない（元の）データでの精度を計算
   - → **高い精度になる可能性がある**

## 🎯 具体例

```
元の画像（簡単）: "good" → モデルが正しく予測しやすい
↓ データ拡張
拡張された画像（難しい）: 45度回転、明るさ70%、20%拡大 → 予測が難しくなる
```

**訓練精度**: 拡張された画像での精度 → **低い**（31.97%）
**バリデーション精度**: 元の画像での精度 → **高い**（80.54%）

## ⚠️ なぜこれが問題か

1. **モデルが適切に学習できていない**
   - 拡張が強すぎて、モデルが本質的な特徴を学習できない

2. **性能評価が不正確**
   - 訓練精度とバリデーション精度の比較が意味をなさない

3. **過学習の検出ができない**
   - 通常、訓練精度 > バリデーション精度なら過学習
   - しかし、この異常な状況では判断できない

## 🔧 解決策

### オプション1: データ拡張を弱める（推奨）

```python
# 中程度の拡張に変更
sparse_augmentation_params = {
    'rotation_range': 15,           # 30→15に減らす
    'width_shift_range': 0.1,       # 0.2→0.1に減らす
    'height_shift_range': 0.1,
    'shear_range': 0.1,             # 0.2→0.1に減らす
    'zoom_range': 0.1,              # 0.2→0.1に減らす
    'horizontal_flip': True,
    'vertical_flip': False,         # 垂直反転は無効化
    'brightness_range': [0.9, 1.1], # [0.8, 1.2]→[0.9, 1.1]に減らす
    'channel_shift_range': 0.05,    # 0.1→0.05に減らす
}
```

### オプション2: バリデーションデータにも軽い拡張を適用

訓練精度とバリデーション精度を公平に比較するため：

```python
# バリデーションデータにも軽い拡張
val_datagen = ImageDataGenerator(
    rescale=1./255,
    rotation_range=5,      # 軽い回転
    brightness_range=[0.95, 1.05],  # 軽い明るさ変化
)
```

### オプション3: 正則化を緩める

現在の設定：
- `dropout_rate: 0.5` → **非常に高い**（50%のニューロンを無効化）
- `l1_lambda: 0.001`
- `l2_lambda: 0.0001`

これらが学習を妨げている可能性があります。

## 📈 理想的な状態

```
訓練精度: 80-90%以上（拡張されたデータでも高精度）
バリデーション精度: 75-85%（元のデータでの精度）
差: 5-10%以内（適切な差）

現在:
訓練精度: 31.97%
バリデーション精度: 80.54%
差: 約48%（異常）
```

## ✅ 推奨アクション

1. **データ拡張を弱める**（即座に効果が出る）
2. **dropout_rateを下げる**（0.5 → 0.3-0.4）
3. **学習率を調整する**
4. **エポック数を増やす**（現在は早すぎる段階で終了している可能性）

現在の設定では、モデルが**拡張されたデータをうまく学習できていない**ため、訓練精度が低くなっています。




















