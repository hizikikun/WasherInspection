# 統合ワッシャー検査・学習アプリケーション ガイド

## 🎯 概要

すべての機能を統合したPyQt5アプリケーションです。

### 統合機能

1. **外観検査** - リアルタイムでワッシャーの欠陥を検出
2. **スパースモデリング学習** - 高精度なモデルの学習
3. **進捗ビューアー** - HWiNFO統合済みのリアルタイム進捗表示
4. **リソース選択** - GPU/CPU負荷レベルを選択

## 🚀 起動方法

```bash
python dashboard/integrated_washer_app.py
```

## 📑 タブ構成

### タブ1: 外観検査

#### 機能
- **リアルタイムカメラ映像**
  - カメラからの映像をリアルタイムで表示
  - ワッシャーの欠陥を自動検出

- **予測結果表示**
  - 予測クラス（good, black_spot, chipping, scratch）
  - 信頼度（0-100%）

- **アンサンブル予測**
  - EfficientNetB0, B1, B2の3つのモデルで予測
  - 予測結果を平均して最高精度を実現

#### 使い方
1. 「検査開始」ボタンをクリック
2. カメラ映像が表示される
3. 予測結果と信頼度がリアルタイムで更新される
4. 「検査停止」ボタンで停止

---

### タブ2: 学習

#### 機能
- **リソースレベル選択**
  - [1] 軽量（省エネモード） - 他の作業をしながら
  - [2] 標準（バランス） - バランス重視
  - [3] 高性能（推奨） - 速度と精度のバランス ⭐推奨
  - [4] 最大性能（フル活用） - 最高の精度と速度

- **学習進捗表示**
  - 全体進捗バー
  - エポック数
  - 精度（訓練/検証）

- **学習制御**
  - 「学習開始」ボタンで開始
  - 「学習停止」ボタンで中断

#### 使い方
1. リソースレベルを選択（デフォルト: [3]）
2. 「学習開始」ボタンをクリック
3. 進捗をリアルタイムで確認
4. 必要に応じて「学習停止」で中断

---

### タブ3: 進捗・システム情報

#### 機能
- **システム情報（HWiNFO統合）**
  - CPU使用率・温度
  - メモリ使用率
  - GPU使用率・温度・電力（HWiNFOから直接取得）
  - プログレスバーで視覚的に表示

- **学習進捗（詳細）**
  - モデル名・エポック数
  - 全体進捗
  - 経過時間・残り時間

#### HWiNFO統合の特徴
- **2秒ごとに自動更新**
- **HWiNFOから直接取得**（最も信頼できる情報源）
- **リアルタイムで表示**

---

## 🔧 システム要件

### 必須
- Python 3.8以上
- TensorFlow 2.x
- PyQt5
- OpenCV (cv2)
- NumPy

### 推奨
- HWiNFO64（システム情報の精度向上）
- NVIDIA GPU（学習速度向上）

### オプション
- カメラ（外観検査用）

## 📦 インストール

```bash
pip install tensorflow PyQt5 opencv-python numpy
```

## 🎯 主な機能

### 1. 外観検査

#### アンサンブル予測
- EfficientNetB0, B1, B2の3つのモデルを使用
- 各モデルの予測を平均して最高精度を実現
- 入力サイズに応じて自動リサイズ（224/240/260）

#### モデル読み込み
自動的に以下のパスからモデルを検索：

```
clear_sparse_best_4class_*_model.h5
clear_sparse_ensemble_4class_*_model.h5
models/sparse/clear_sparse_ensemble_4class_model_*.h5
models/sparse/sparse_ensemble_4class_model_*.h5
models/ensemble/ensemble_4class_model_*.h5
```

---

### 2. スパースモデリング学習

#### リソースレベル

| レベル | Batch Size | Workers | Max Epochs | GPU/CPU使用率 |
|--------|-----------|---------|------------|--------------|
| 1 | 8 | 1 | 100 | 低 |
| 2 | 16 | 4 | 150 | 中 |
| 3 | 32 | 8 | 200 | 高 ⭐推奨 |
| 4 | 64 | 16 | 300 | 最大 |

#### 学習設定
- 事前学習済み重み（ImageNet）を使用
- 最適化されたデータ拡張
- 正則化パラメータ調整済み
- クラス不均衡対策

---

### 3. 進捗ビューアー（HWiNFO統合）

#### 取得する情報
- **CPU**: 使用率、温度
- **メモリ**: 使用率、使用量/総量
- **GPU**: 使用率、温度、電力、VRAM（HWiNFOから直接取得）

#### 更新頻度
- **2秒ごとに自動更新**
- HWiNFOから直接取得するため、リアルタイム性が高い

---

## 🎨 UIの特徴

- **モダンなデザイン**: Fusionスタイル
- **タブ切り替え**: 機能ごとに整理
- **リアルタイム更新**: 自動で最新情報を表示
- **日本語対応**: すべての表示が日本語

## 🔄 動作フロー

### 外観検査
```
カメラ起動
  ↓
映像を取得（10fps）
  ↓
アンサンブルモデルで予測
  ↓
結果を表示
```

### 学習
```
リソースレベル選択
  ↓
設定を環境変数に適用
  ↓
学習スクリプトを実行
  ↓
進捗をリアルタイムで表示
  ↓
HWiNFOからシステム情報を取得
```

## ⚙️ 設定

### カメラID
デフォルト: 0（変更可能）

### モデルパス
自動検索（上記のパスから検索）

### HWiNFO統合
- HWiNFOが起動している必要がある
- Shared Memory Supportが有効である必要がある

## 📊 パフォーマンス

### 外観検査
- **フレームレート**: 約10fps
- **予測精度**: アンサンブルで高精度

### 学習
- **リソースレベル3**: バランスが良い
- **リソースレベル4**: 最高の精度と速度

### システム情報
- **更新頻度**: 2秒ごと
- **精度**: HWiNFOから直接取得（最も正確）

## 🐛 トラブルシューティング

### カメラが開けない
- カメラIDを変更
- カメラが接続されているか確認

### モデルが読み込めない
- モデルファイルが存在するか確認
- `models/sparse/`ディレクトリを確認

### HWiNFO情報が表示されない
- HWiNFOが起動しているか確認
- Shared Memory Supportが有効か確認

### 学習が開始しない
- TensorFlowがインストールされているか確認
- データディレクトリが存在するか確認

## ✅ まとめ

統合アプリケーションで以下を実行できます：

1. ✅ **外観検査** - リアルタイムで欠陥検出
2. ✅ **スパースモデリング学習** - 高精度モデルの学習
3. ✅ **進捗ビューアー** - HWiNFO統合済み
4. ✅ **リソース選択** - GPU/CPU負荷レベルを選択

すべてが1つのアプリケーションに統合されています！




















